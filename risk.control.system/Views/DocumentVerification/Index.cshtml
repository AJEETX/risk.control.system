@model ImageAnalysisViewModel

@{
	ViewData["Title"] = "Document Forensic Analysis";
	Layout = "~/Views/Shared/_LayoutGuest.cshtml";
}

<section class="content  tool-match-section">
	<div id="article" class="card shadow-lg border-0 summarizer-card">

		@* 1. Header with integrated Usage Badge *@
		<div class="card-header d-flex align-items-center bg-warning">
			<i class="fas fa-microscope mr-2"></i>
			<h5 class="mb-0 font-weight-bold">DocuCheck Forensics</h5>

			<div class="ml-auto ms-auto">
				<span id="usageBadge"
					  class="badge usage-badge-custom shadow-sm @(Model.RemainingTries <= 1 ? "badge-soft-danger" : "badge-soft-warning")">
					<i class="fas @(Model.RemainingTries <= 1 ? "fa-exclamation-circle" : "fa-clock") mr-1 small"></i>
					<span id="remainingCount">@Model.RemainingTries</span> tries left
				</span>
			</div>
		</div>

		<div class="card-body p-4">
			<div class="submit-progress hidden">
				<i class="fas fa-sync fa-spin fa-4x fa-fw text-warning"></i>
			</div>

			<form asp-action="Upload" method="post" enctype="multipart/form-data" id="analysisForm">
				<div class="row">
					@* Left Side: Drop Zone (Stays as is) *@
					<div class="col-md-6 mb-4 text-center border-right">
						<label class="h6 font-weight-bold text-warning mb-3" for="drop-zone">
							<span class="badge badge-warning rounded-circle mr-1 text-white">1</span> Select Image
						</label>
						<div id="drop-zone" class="pdf-drop-zone d-flex flex-column align-items-center justify-content-center p-4 @(Model.RemainingTries <= 0 ? "disabled-zone" : "")">
							<input id="fileInput" name="file" type="file" class="d-none" accept="image/jpeg, image/png" required @(Model.RemainingTries <= 0 ? "disabled" : "") />

							<div class="text-center">
								<i class="fas fa-file-image fa-4x text-warning mb-3" id="previewIcon"></i>
								<h6 class="text-warning font-weight-bold">Drop Image Here</h6>
								<p class="small text-muted mb-0">JPEG or PNG up to 10MB</p>
								<div id="fileNameDisplay" class="badge badge-light p-2 mt-3 d-none text-truncate border"></div>
							</div>
						</div>
					</div>

					@* Right Side: Dynamic Content *@
					<div class="col-md-6 mb-4 text-center animate__animated animate__fadeIn">
						@if (string.IsNullOrEmpty(Model.ElaImageUrl))
						{
							@* DEFAULT VIEW: Methodology *@
							<label class="h6 font-weight-bold text-secondary mb-3">
								<span class="badge badge-warning rounded-circle mr-1 text-white">2</span> Analysis Methodology
							</label>

							<div class="summary-box-container text-left p-3 border rounded shadow-sm bg-light">
								<h6 class="font-weight-bold text-dark small"><i class="fas fa-search-plus mr-2"></i> Error Level Analysis (ELA)</h6>
								<p class="small text-muted">Our AI resaves the image at a known compression rate to identify pixel inconsistencies. Genuine areas show uniform noise.</p>

								<h6 class="font-weight-bold text-dark small mt-3"><i class="fas fa-fingerprint mr-2"></i> Metadata Sanitization</h6>
								<p class="small text-muted">Checks for signatures from Adobe Photoshop, GIMP, or Canva indicating modifications.</p>
							</div>
						}
						else
						{
							@* RESULT VIEW: Integrity Verdict *@
							<label class="h6 font-weight-bold text-dark mb-3">
								<span class="badge badge-success rounded-circle mr-1 text-white">2</span> Integrity Verdict
							</label>

							<div class="text-center">
								<div class="analysis-stage bg-light mb-4">
									<div class="comparison-slider" id="slider-container">
										<img src="@Model.OriginalImageUrl" class="w-100 h-100 img-contain" alt="original" />
										<div class="img-overlay" id="ela-overlay">
											<img src="@Model.ElaImageUrl" class="w-100 h-100" alt="processed" />
										</div>
										<div class="slider-handle" id="handle">
											<div class="handle-circle"><i class="fas fa-arrows-alt-h"></i></div>
										</div>
									</div>
								</div>
								@* Metadata Status *@
								<div class="card border-0 shadow-sm rounded-4 bg-light p-2">
									<div class="row g-2 no-gutters">
										@* Left Half *@
										<div class="col-6 border-right">
											<div class="d-flex align-items-center justify-content-center p-2">
												<i class="fas @(Model.MetadataFlagged ? "fa-exclamation-triangle text-danger" : "fa-check-circle text-success") mr-2"></i>
												<div class="text-left">
													<div class="small opacity-50 font-weight-bold">METADATA</div>
													<div class="small font-weight-bold">@(Model.MetadataFlagged ? "Flagged" : "Clear")</div>
												</div>
											</div>
										</div>
										@* Right Half *@
										<div class="col-6">
											<div class="d-flex align-items-center justify-content-center p-2">
												<i class="fas fa-layer-group text-info mr-2"></i>
												<div class="text-left">
													<div class="small opacity-50 font-weight-bold">ELA</div>
													<div class="small font-weight-bold">@Model.ElaStatus (@Model.ElaScore%)</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						}
					</div>
				</div>

				<div class="mt-2">
					<button type="submit" id="analyzeBtn" class="btn btn-outline-warning btn-lg w-100 shadow rounded-pill" @(Model.RemainingTries <= 0 ? "disabled" : "")>
						<i class="fas @(Model.RemainingTries <= 0 ? "fa-lock" : "fa-magic") mr-2"></i>
						<span>@(Model.RemainingTries <= 0 ? "Limit Reached" : "Run Forensic Audit")</span>
						<span id="btnSpinner" class="spinner-border spinner-border-sm d-none"></span>
					</button>
				</div>
			</form>
		</div>
	</div>
</section>

@section Scripts {
	<script src="~/js/tool/doc-verification.js"></script>
}