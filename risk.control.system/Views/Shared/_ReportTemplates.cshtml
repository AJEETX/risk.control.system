@model List<ReportTemplate>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-header">
            <tr>
                <th>CLONE</th>
                <th>Name</th>
                <th>IsActive</th>
                <th>Created</th>
                <th title="Face IDs"><i class="fas fa-id-badge"></i> </th>
                <th title="Documents"><i class="fas fa-file-alt"></i> </th>
                <th title="Media Files"><i class="fas fa-film"></i> </th>
                <th title="Questions"><i class="fas fa-question-circle"></i></th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                foreach (var template in Model)
                {
                    var faceCount = template.LocationReport
                    .SelectMany(l => l.FaceIds)
                    .Count(i => i.Selected);

                    var docCount = template.LocationReport
                    .SelectMany(l => l.DocumentIds)
                    .Count(i => i.Selected);

                    var mediaCount = template.LocationReport
                    .SelectMany(l => l.MediaReports)
                    .Count(i => i.Selected);

                    var questionCount = template.LocationReport
                    .SelectMany(l => l.Questions)
                    .Count(); // all questions, no "Selected" property

                    <tr>
                        <td>
                            <a  asp-action="CloneDetails" asp-controller="ReportTemplate" asp-route-templateId="@template.Id"
                               class="btn btn-sm btn-outline-secondary clone-template">
                                <i class="fas fa-copy"></i> Clone
                            </a>
                        </td>
                        <td>@template.Name</td>
                        <td>
                            @if (template.IsActive)
                            {
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">
                                    <i class="fas fa-times-circle"></i> Inactive
                                </span>
                            }
                        </td>
                        <td>
                            <small> 
                                @template.Created.ToString("dd-MMM-yyyy") 
                            </small>
                         </td>
                        <td>@faceCount</td>
                        <td>@docCount</td>
                        <td>@mediaCount</td>
                        <td>@questionCount</td>
                        <td>
                            <a asp-action="Details" asp-controller="ReportTemplate" asp-route-id="@template.Id"
                               class="btn btn-sm  btn-outline-secondary">
                                <i class="fas fa-eye"></i> View
                            </a>
                            @if (!template.IsActive)
                            {
                                <button class="btn btn-sm btn-outline-danger delete-template" data-id="@template.Id">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            }
                            else
                            {
                                <button disabled class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-times-circle"></i> Delete
                                </button>
                            }
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center text-muted py-4">
                        <i class="fas fa-info-circle fa-lg me-2"></i> No report templates found.
                    </td>
                </tr>
            }
        
        </tbody>
    </table>
</div>
