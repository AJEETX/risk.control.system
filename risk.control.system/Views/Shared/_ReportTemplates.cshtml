@model List<ReportTemplate>

<div class="table-responsive">
    <table class="table table-bordered table-striped table-hover dt-responsive nowrap w-100">
	<thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Created</th>
                <th title="Face IDs"><i class="fas fa-id-badge"></i> </th>
                <th title="Documents"><i class="fas fa-file-alt"></i> </th>
                <th title="Media Files"><i class="fas fa-film"></i> </th>
                <th title="Questions"><i class="fas fa-question-circle"></i></th>
                <th data-toggle="tooltip" title="[Clone] | [View] | [Delete]">Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                foreach (var template in Model)
                {
                    var faceCount = template.LocationReport
                    .SelectMany(l => l.FaceIds)
                    .Count(i => i.Selected);

                    var docCount = template.LocationReport
                    .SelectMany(l => l.DocumentIds)
                    .Count(i => i.Selected);

                    var mediaCount = template.LocationReport
                    .SelectMany(l => l.MediaReports)
                    .Count(i => i.Selected);

                    var questionCount = template.LocationReport
                    .SelectMany(l => l.Questions)
                    .Count(); // all questions, no "Selected" property

                    <tr>
                        <td title="@(template.Name)">
                            @if (template.Name.Length <= 50)
                            {
                                @template.Name
                            }
                            else
                            {
                                @template.Name.Substring(0, 50) <span>...</span>
                             }
                        </td>

                        <td>
                            @if (template.IsActive)
                            {
                                <span class="badge bg-success" data-toggle="tooltip" title="Active">
                                    <i class="fas fa-check-circle"></i> 
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-secondary" data-toggle="tooltip" title="InActive">
                                    <i class="fas fa-times-circle"></i>
                                </span>
                            }
                        </td>
                        <td data-toggle="tooltip" title="@template.Created.ToString("dd-MMM-yyyy HH:mm")">
                            <small>
                                @{
                                    var created = template.Created;
                                    var now = DateTime.Now;
                                    var diff = now.Date - created.Date;
                                    string displayText;

                                    if (diff.TotalDays < 1)
                                    {
                                        displayText = $"Today at {created:HH:mm}";
                                    }
                                    else if (diff.TotalDays < 2)
                                    {
                                        displayText = $"Yesterday at {created:HH:mm}";
                                    }
                                    else if (diff.TotalDays < 7)
                                    {
                                        displayText = $"{diff.Days} days ago";
                                    }
                                    else
                                    {
                                        displayText = created.ToString("dd-MMM-yyyy");
                                    }
                                }
                                @displayText
                            </small>
                        </td>
                        <td>@faceCount</td>
                        <td>@docCount</td>
                        <td>@mediaCount</td>
                        <td>@questionCount</td>
                        <td>
                            <a  asp-action="CloneDetails" asp-controller="ReportTemplate" asp-route-templateId="@template.Id"
                               class="btn btn-sm btn-outline-secondary clone-template">
                                <i class="fas fa-copy"></i> Clone
                            </a>
                            <a asp-action="Details" asp-controller="ReportTemplate" asp-route-id="@template.Id"
                               class="btn btn-sm  btn-outline-secondary">
                                <i class="fas fa-eye"></i> View
                            </a>
                            @if (!template.IsActive)
                            {
                                <button class="btn btn-sm btn-outline-danger delete-template" data-id="@template.Id">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            }
                            else
                            {
                                <button disabled class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-times-circle"></i> Delete
                                </button>
                            }
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center text-muted py-4">
                        <i class="fas fa-info-circle fa-lg me-2"></i> No report templates found.
                    </td>
                </tr>
            }
        
        </tbody>
    </table>
</div>
